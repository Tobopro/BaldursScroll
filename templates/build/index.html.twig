{% extends 'base.html.twig' %}

{% block title %}Hello BuilderController!
{% endblock %}

{% block body %}
	<div class="myform-container">
		<h1>{{ character.name }}</h1>

		<div class="myform">

			<button class="accordion first-section-builder">Class</button>
			<div class="panel-open">
				<div class="info-panel">
					<h3>{{ character.idSubClasses.idClass.name }}</h3>

					<p>startingHp:
						{{ character.idSubClasses.idClass.startingHp }}</p>
					<p>onLevelUpHp:
						{{ character.idSubClasses.idClass.onLevelUpHp }}</p>
					<p>savingThrowProficency1:
						{{ character.idSubClasses.idClass.savingThrowProficency1 }}</p>
					<p>savingThrowProficency2:
						{{ character.idSubClasses.idClass.savingThrowProficency2 }}</p>


				</div>
			</div>

			<button class="accordion">Subclass</button>
			<div class="panel-open ">
				<div class="info-panel">
					<h3>{{character.idSubClasses.name }}</h3>

				</div>
			</div>

			<button class="accordion">Race</button>
			<div class="panel-open ">
				<div class="info-panel">
					<h3>{{  character.idSubRace.idRace.name }}</h3>

				</div>
			</div>

			<button class="accordion">Subrace</button>
			<div class="panel-open ">
				<div class="info-panel">
					<h3>{{ character.idSubRace.name }}</h3>

					<p>Speed :
						{{character.idSubRace.speed }}</p>

				</div>
			</div>

			<button class="accordion">Abilities</button>
			<div class="panel-open">
				<div class="form-group-panel">
					<section class="ability-container ">
						<div class='row_ability'>
							<h2>Characters Ability Points.</h2>
						</div>

						<div class='row_ability'>
							<h3>Ability Point</h3>
							<h3>Bonus</h3>
						</div>
						<div class='row_ability'>
							<h4 class='ability_point'></h4>
							<div class='ability_bonus'>
								<h4>+2</h4>
								<h4>+1</h4>
							</div>
						</div>

						<div class='row_ability'>
							<div class='ability_choice'>
								<label for="Strength">Strength:</label>

								<div class="number-input">
									<p class="" id="Strength" name="Strength">{{ character.strength }}</p>
								</div>
							</div>
							<div class='ability_bonus'>
								<label class="container-checkbox">
									<input type="radio" id="Ability1" name="Ability1" value="Strength" {% if character.abilityScoreBonus1 == 'STR' %} checked {% endif %} disabled/>

									<span class="checkmark"></span>
								</label>
								<label class="container-checkbox">
									<input type="radio" id="Ability2" name="Ability2" value="Strength" {% if character.abilityScoreBonus2 == 'STR' %} checked {% endif %} disabled/>
									<span class="checkmark"></span>
								</label>
							</div>

						</div>
						<div class='row_ability'>
							<div class='ability_choice'>
								<label for="Dexterity">Dexterity:</label>

								<div class="number-input">
									<p class="" id="Dexterity" name="Dexterity">{{ character.dexterity }}</p>
								</div>
							</div>
							<div class='ability_bonus'>
								<label class="container-checkbox">
									<input type="radio" id="Ability1" name="Ability1" value="Dexterity" {% if character.abilityScoreBonus1 == 'DEX' %} checked {% endif %} disabled/>
									<span class="checkmark"></span>
								</label>
								<label class="container-checkbox">
									<input type="radio" id="Ability2" name="Ability2" value="Dexterity" {% if character.abilityScoreBonus2 == 'DEX' %} checked {% endif %} disabled/>
									<span class="checkmark"></span>
								</label>
							</div>

						</div>
						<div class='row_ability'>
							<div class='ability_choice'>
								<label for="Constitution">Constitution:</label>
								<div class="number-input">
									<p class="" id="Constitution" name="Constitution">{{ character.constitution }}</p>
								</div>

							</div>
							<div class='ability_bonus'>
								<label class="container-checkbox">
									<input type="radio" id="Ability1" name="Ability1" value="Constitution" {% if character.abilityScoreBonus1 == 'CON' %} checked {% endif %} disabled/>
									<span class="checkmark"></span>
								</label>
								<label class="container-checkbox">
									<input type="radio" id="Ability2" name="Ability2" value="Constitution" {% if character.abilityScoreBonus2 == 'CON' %} checked {% endif %} disabled/>
									<span class="checkmark"></span>
								</label>
							</div>

						</div>
						<div class='row_ability'>
							<div class='ability_choice'>
								<label for="Intelligence">Intelligence:</label>

								<div class="number-input">
									<p class="" id="Intelligence" name="Intelligence">{{ character.intelligence }}</p>
								</div>
							</div>
							<div class='ability_bonus'>
								<label class="container-checkbox">
									<input type="radio" id="Ability1" name="Ability1" value="Intelligence" {% if character.abilityScoreBonus1 == 'INT' %} checked {% endif %} disabled/>
									<span class="checkmark"></span>
								</label>
								<label class="container-checkbox">
									<input type="radio" id="Ability2" name="Ability2" value="Intelligence" {% if character.abilityScoreBonus2 == 'INT' %} checked {% endif %} disabled/>
									<span class="checkmark"></span>
								</label>
							</div>

						</div>
						<div class='row_ability'>
							<div class='ability_choice'>
								<label for="Wisdom">Wisdom:</label>

								<div class="number-input">
									<p class="" id="Wisdom" name="Wisdom">{{ character.wisdom }}</p>
								</div>
							</div>
							<div class='ability_bonus'>
								<label class="container-checkbox">
									<input type="radio" id="Ability1" name="Ability1" value="Wisdom" {% if character.abilityScoreBonus1 == 'WIS' %} checked {% endif %} disabled/>
									<span class="checkmark"></span>
								</label>
								<label class="container-checkbox">
									<input type="radio" id="Ability2" name="Ability2" value="Wisdom" {% if character.abilityScoreBonus2 == 'WIS' %} checked {% endif %} disabled/>
									<span class="checkmark"></span>
								</label>
							</div>

						</div>
						<div class='row_ability'>
							<div class='ability_choice'>
								<label for="Charisma">Charisma:</label>

								<div class="number">
									<p class="" id="Charisma" name="Charisma">{{ character.charisma }}</p>
								</div>
							</div>
							<div class='ability_bonus'>
								<label class="container-checkbox">
									<input type="radio" id="Ability1" name="Ability1" value="Charisma" {% if character.abilityScoreBonus1 == 'CHA' %} checked {% endif %} disabled/>
									<span class="checkmark"></span>
								</label>
								<label class="container-checkbox">
									<input type="radio" id="Ability2" name="Ability2" value="Charisma" {% if character.abilityScoreBonus2 == 'CHA' %} checked {% endif %} disabled/>
									<span class="checkmark"></span>
								</label>
							</div>

						</div>

					</section>
				</div>
			</div>

			<button class="accordion">Spells available</button>
			<div class="panel-open ">
				<div class="info-panel">

					<h3>Race spells</h3>
					<ul>
						{% for spell in raceSpells %}
							<li>{{ spell.idSpell.name }}</li>
						{% else %}
							<li>No spells with this race.</li>
						{% endfor %}
					</ul>


					<h3>Class spells</h3>
					<ul>
						{% for spell in classSpells %}
							<li>{{ spell.idSpell.name }}</li>
						{% else %}
							<li>No spells with this class.</li>
						{% endfor %}
					</ul>
					{% if app.user %}
						{# {% if app.user.id == character.idUsers.id or is_granted('ROLE_ADMIN')%} #}
						{% if is_granted('edit', character) %}


							<a href="{{ path('app_builder_update', {'id': character.id}) }}" class="mybtn">Edit the character</a>


							<!-- Bouton pour ouvrir la modale -->
							<a href="#" class="mybtn-delete" id="deleteBtn">
								Delete</a>

							<!-- Modale -->
							<div id="myModal" class="modal__modal ">
								<div class="modal__modal-content">
									<span class="close">&times;</span>
									<p>Are you sure you want to delete this character ?</p>
									<p>This action is irreversible.</p>
									<a href="{{ path('app_builder_delete', {'id': character.id}) }}">
										<button id="confirmDeleteBtn" class="mybtn-modal">Delete this character</button>
									</a>

								</div>
							</div>
						{% endif %}
					{% endif %}


				</div>

			</div>
		</div>
		<section class="likes my-5">
			{% if app.user %}
				{# {% if character.getLiked(app.user)|length > 0 %} #}
				{% if app.user.doesLikes(character) %}
					<a href="{{ path('app_build_liked', {'characterId': character.id}) }}">
						<i class="fa-solid fa-2xl  fa-thumbs-up"></i>

					</a>
				{% else %}
					<a href="{{ path('app_build_liked', {'characterId': character.id}) }}">
						<i class="fa-regular fa-2xl fa-thumbs-up"></i>
					</a>


				{% endif %}
			{% endif %}

			{% if character.getLikes %}
				<p>{{ character.getLikes() }}
					like</p>
			{% else %}
				<p>No likes yet</p>
			{% endif %}
		</section>

		<!-- Section des commentaires -->
		<section class="comments-section my-5">

			<h2>Comments</h2>

			<!-- Afficher les commentaires existants -->
			<div class="existing-comments">

				{% for commentary in commentaries %}
					<div class="comment my-5">
						<p>{{ commentary.text }}
							{% if app.user %}
								{% if app.user.id == commentary.author.id %}
									<a href="{{ path('app_build_commentary_delete', {'commentaryId': commentary.id, 'characterId': character.id} ) }}" class="btn btn-danger ms-5">Delete your comment</a>
								{% else %}
									{% if commentary.isFlaged == true %}

										<p class="text-danger">Comment flaged</p>
									{% else %}
										<a href="{{ path('app_build_commentary_report', {'commentaryId': commentary.id, 'characterId': character.id} ) }}" class=" mx-5">
											<i class="fa-regular fa-flag"></i>
										</a>
									{% endif %}


								{% endif %}
							{% endif %}
						</p>
					</p>
					<p>Posted by
						{{commentary.author.username}}
						on
						{{ commentary.createdAt|date('d/m/Y') }}</p>


					<h5>Add a response</h5>

					<form action="{{ path('app_build_commentary_response', {'commentaryId': commentary.id, 'characterId': character.id} ) }}" method="POST">


						<label for="response">your response :</label>
						<textarea name="response" id="response" cols="30" rows="1"></textarea>

						<button type="submit" class="">Submit</button>
					</form>


					{% for response in responses %}
						{% if response.response.id == commentary.id %}
							<div class="response">
								<p>{{response.author.username}}
									responded ({{ response.createdAt|date('d/m/Y') }}) :</p>

								<p>{{ response.text }}
									<a href="{{ path('app_build_commentary_delete', {'responseId': response.id, 'commentaryId': commentary.id, 'characterId': character.id} ) }}" class=" ms-5">Delete your response</a>
								</p>


							</div>


						{% endif %}
					</div>

				{% else %}
					<p>No responses yet.</p>
				{% endfor %}


			{% else %}
				<p>No comments yet.</p>
			{% endfor %}
		</div>


		{% if app.user %}
			<!-- Formulaire pour soumettre un nouveau commentaire -->
			<div class="comment-form my-5">
				<h3>Add a comment</h3>
				{{form_start(form)}}
				{{form_row(form.text)}}
				{{form_row(form.save)}}
				{{form_end(form)}}
			</div>

		{% endif %}


	</section>
</div>

<script src='{{ asset('js/modal.js') }}'></script>{% endblock %}
